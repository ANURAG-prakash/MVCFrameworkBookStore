@model IEnumerable<CommonLayer.Models.BookModel>

@{
    ViewBag.Title = "AllBooks";
}
<script src="~/Scripts/JavaScript/Books.js"></script>
<script>
    function AddToCart(bookId) {

        var addToCartId = "addtoCartBtn-".concat(bookId);
        var addToWishId = "wishlistBtn-".concat(bookId);
        var addedToCartId = "addedtocartBtn-".concat(bookId);
        var addedToWishlistId = "addedtowishlistBtn-".concat(bookId);

        if (sessionStorage.getItem("JwtToken") == null) {
            window.location.href = 'https://localhost:44301/Users/Login';
        } else {
            var requestObject = {};
            requestObject.UserId = 1;
            requestObject.BookId = bookId;
            requestObject.Quantity = 1;
            console.log(JSON.stringify(requestObject));
            $.ajax({
                type: "POST",
                url: 'https://localhost:44301/Books/AddToCart',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + sessionStorage.getItem("JwtToken")
                },
                data: JSON.stringify(requestObject),
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function () {

                    var AddToCartButton = document.getElementById(addToCartId);
                    AddToCartButton.style.display = "none";


                    var AddToWishListButton = document.getElementById(addToWishId);
                    AddToWishListButton.style.display = "none";


                    var AddedToCartButton = document.getElementById(addedToCartId);
                    AddedToCartButton.style.display = "block";

                    var AddedToWishlistButton = document.getElementById(addedToWishlistId);
                    AddedToWishlistButton.style.display = "none";


                },
                error: function () {
                    alert("Error while inserting data");
                }
            });

        }
    }
</script>


@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

    <div class="BookBody2">
        <div class="Title">Books(20)</div>

        <div class="AllBooks">
            <div style="display: flex; flex-wrap: wrap; margin-left: 7%; margin-right:7%;">
                @foreach (var items in Model)
                {
                    <div class="card">
                        <div>
                            <div class="First-part" style="width: 220px;">
                                <img src=@items.Image
                                     class="card-img-top"
                                     alt="..." style="width:100px ; height:130px ; padding: 10px 20px 10px 20px;" />
                            </div>
                            <div class="Second-part">
                                <div class="Second-part2">

                                    <div class="bookName">@items.BookName </div>
                                    <div class="by">
                                        by
                                        <label>@items.Authors</label>
                                    </div>
                                    <div class="rating">
                                        <div class="rate">4.5</div>
                                        <div class="number">
                                            (@items.AvailabeBooks)
                                        </div>
                                    </div>
                                    <div class="price">Rs.@items.Price</div>
                                </div>
                                <div class="Buttons">
                                    <input type="button" value="Add to Cart" class="AddtoCartbutton" id="addtoCartBtn-@items.BookId" onclick="AddToCart(@items.BookId)">
                                    <input type="button" value="WishList" class="Wishlistbutton" id="wishlistBtn-@items.BookId" onclick="AddToWishList(@items.BookId)">
                                    <input type="button" value="Added to Cart" class="AddedToCartbutton" style="display: none; background: rgb(39 31 159); color: white; width: 100%; margin-left: 10px ; height:25px" id="addedtocartBtn-@items.BookId">
                                    <input type="button" value="Added to Wishlist" class="AddedToWishlistbutton" style="display: none; background: rgb(39 31 159); color: white; width: 100%; margin-left: 10px ; height:25px" id="addedtowishlistBtn-@items.BookId">
                                </div>
                            </div>
                        </div>
                    </div>


                }
            </div>
        </div>

    </div>
}


@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}
